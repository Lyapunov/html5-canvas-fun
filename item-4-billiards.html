<!DOCTYPE HTML>
<html>
   <head>
      <style>
         body {
            margin : 0px;
            padding: 0px;
         }
      </style>
   </head>
   <body>
   	<canvas id="canvas" width="500" height="500"></canvas>

      <script>
         var mainItem     = document.getElementById('canvas');
         var context      = mainItem.getContext('2d');
         var screenWidth  = mainItem.width  = window.innerWidth  - 20;
         var screenHeight = mainItem.height = window.innerHeight - 20;
         var metric       = Math.min( screenWidth / 2, screenHeight / 2 );
         var ANIMATION;  // ??
         var isHitOK = 1;
         var isMouseDown = 0;
         var firstHitPos  = [];
         var secondHitPos = [];

         function Ball(color, radius = 0.2, centerX = 0, centerY = 0) {
            this.color = color;
            this.radius = radius;
            this.centerX = centerX; 
            this.centerY = centerY;
            this.draw = function() {
               context.beginPath();
               context.fillStyle = this.color;
               var px = screenWidth  / 2 + ( this.centerX ) * metric;
               var py = screenHeight / 2 + ( this.centerY ) * metric;
               context.arc( px, py, this.radius * metric, 0, 2 * Math.PI, false );
               context.closePath();
               context.fill();
            };
         }

         function Balls() {
            this.balls = [ new Ball( "red" ) ];
            this.draw = function() {
               for ( var i = 0; i < this.balls.length; ++i ) {
                  this.balls[i].draw();
               }
            }
         }

         var myBalls = new Balls();

         function drawBackground() {
            context.fillStyle = "black";
            context.fillRect(0,0,screenWidth,screenHeight);
         }

         function drawCurrentHit() {
            if ( firstHitPos.length > 0 && firstHitPos.length > 0 ) {
               context.strokeStyle = "lightblue";
               context.beginPath();
               context.moveTo( firstHitPos[0] , firstHitPos[1]  );
               context.lineTo( secondHitPos[0], secondHitPos[1] );

               context.closePath();
               context.stroke();
            }
         }

         // common functions 
         function drawScene() {
            setTimeout( function() {
               drawBackground();
               myBalls.draw();
               drawCurrentHit();
               ANIMATION = requestAnimationFrame(drawScene);
            }, 1000 / 50 );
         }

         function initCanvas() {
            var style = getComputedStyle(mainItem);
            screenWidth  = mainItem.width  = window.innerWidth  - 20;
            screenHeight = mainItem.height = window.innerHeight - 20;
            metric       = Math.min( screenWidth / 2, screenHeight / 2 );

            // starting the engine only if it is not running
            if ( !ANIMATION ) {
               drawScene();
            }
         }

         mainItem.onmousedown = function(event) {
            isMouseDown = 1;
            firstHitPos = [ event.clientX, event.clientY ];
         };

         mainItem.onmouseup = function(event) {
            isMouseDown = 0;
            firstHitPos = [];
            secondHitPos = [];
         };

         mainItem.onmousemove = function(event) {
            if ( isMouseDown ) {
               secondHitPos = [ event.clientX, event.clientY ];
            }
         };

         //init
         (function() {
            initCanvas();
            addEventListener('resize', initCanvas, false);
         })();
      </script>
   </body>
</html>
