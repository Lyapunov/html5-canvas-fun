<!DOCTYPE HTML>
<html>
   <head>
      <style>
         body {
            margin : 0px;
            padding: 0px;
         }
      </style>
   </head>
   <body>
   	<canvas id="canvas" width="500" height="500">
      Your browser doesn't support html5 canvas.
      </canvas>
      <script>
         var mainItem     = document.getElementById('canvas');
         var context      = mainItem.getContext('2d');

         var screenWidth  = mainItem.width  = window.innerWidth  - 20;
         var screenHeight = mainItem.height = window.innerHeight - 20;
         var screenScale  = Math.min( screenWidth, screenHeight ) / 2;

         var fps = 25;
         var ANIMATION;

         // http://www.williammalone.com/articles/create-html5-canvas-javascript-sprite-animation/
         var animImages = [];
         for ( var i = 0; i < 8; ++i ) {
            var animImage = new Image();
            animImage.src = "avatars/avatar-"+i+".png";
            animImages.push(animImage);
         }
         var phase = 1;

         var imgdata0 = {
            blacks:[ 23,11,24,11,25,11,26,11,27,11,28,11,21,12,22,12,29,12,30,12,20,13,31,13,19,14,32,14,18,15,32,15,18,16,33,16,18,17,33,17,18,18,33,18,18,19,33,19,18,20,19,20,25,20,26,20,33,20,18,21,19,21,25,21,26,21,27,21,33,21,18,22,25,22,26,22,32,22,18,23,32,23,18,24,32,24,19,25,32,25,19,26,31,26,20,27,31,27,19,28,20,28,21,28,30,28,18,29,22,29,23,29,24,29,30,29,18,30,30,30,31,30,17,31,32,31,17,32,33,32,34,32,16,33,35,33,16,34,35,34,16,35,35,35,15,36,36,36,15,37,36,37,15,38,36,38,15,39,36,39,15,40,37,40,14,41,33,41,37,41,14,42,32,42,33,42,37,42,14,43,32,43,33,43,37,43,14,44,32,44,33,44,37,44,14,45,32,45,33,45,37,45,14,46,31,46,33,46,37,46,13,47,17,47,31,47,33,47,37,47,13,48,17,48,31,48,33,48,37,48,13,49,17,49,31,49,33,49,37,49,13,50,17,50,31,50,33,50,37,50,13,51,17,51,31,51,33,51,37,51,13,52,17,52,31,52,33,52,37,52,12,53,17,53,31,53,33,53,37,53,12,54,17,54,30,54,32,54,37,54,12,55,17,55,30,55,32,55,37,55,12,56,17,56,30,56,32,56,37,56,12,57,17,57,30,57,32,57,36,57,12,58,15,58,17,58,21,58,22,58,23,58,30,58,32,58,36,58,12,59,15,59,17,59,21,59,24,59,25,59,30,59,31,59,36,59,12,60,16,60,17,60,21,60,26,60,30,60,31,60,36,60,13,61,17,61,21,61,26,61,30,61,31,61,36,61,13,62,17,62,21,62,26,62,30,62,31,62,36,62,14,63,17,63,21,63,26,63,30,63,36,63,15,64,16,64,17,64,21,64,26,64,29,64,35,64,17,65,21,65,26,65,29,65,35,65,17,66,21,66,26,66,30,66,35,66,17,67,21,67,26,67,30,67,34,67,17,68,21,68,26,68,30,68,34,68,17,69,21,69,26,69,30,69,33,69,17,70,21,70,26,70,30,70,31,70,32,70,17,71,21,71,26,71,30,71,17,72,21,72,26,72,30,72,17,73,21,73,26,73,30,73,18,74,21,74,26,74,30,74,18,75,21,75,26,75,30,75,18,76,21,76,26,76,30,76,18,77,21,77,27,77,30,77,18,78,21,78,27,78,30,78,18,79,22,79,27,79,30,79,19,80,22,80,27,80,30,80,19,81,22,81,27,81,31,81,19,82,20,82,22,82,27,82,31,82,20,83,23,83,27,83,31,83,20,84,23,84,28,84,31,84,20,85,23,85,28,85,31,85,18,86,19,86,23,86,28,86,32,86,17,87,23,87,28,87,32,87,16,88,23,88,29,88,32,88,15,89,29,89,32,89,29,90,33,90,29,91,33,91,28,92,33,92,27,93,33,93,26,94,26,95],
            yellows:[ 28,12,6,30,13,10,31,14,12,31,15,13,32,16,14,32,17,14,32,18,14,32,19,14,24,20,5,32,20,6,24,21,5,32,21,5,24,22,6,31,22,5,31,23,13,31,24,13,31,25,12,30,26,11,30,27,10,29,28,8,19,29,1,29,29,5,19,30,1,29,30,7,18,31,1,27,31,5,18,32,1,26,32,3,18,33,2,25,33,2,34,33,3,18,34,2,34,34,4,18,35,2,34,35,4,18,36,3,35,36,5,18,37,3,35,37,4,17,38,2,35,38,4,17,39,2,35,39,3,17,40,2,36,40,4,17,41,3,36,41,3,17,42,3,36,42,3,17,43,3,36,43,3,17,44,3,36,44,3,17,45,3,36,45,3,17,46,3,36,46,3,16,47,3,36,47,3,16,48,3,36,48,3,16,49,3,36,49,3,16,50,3,36,50,3,16,51,3,36,51,3,16,52,3,36,52,3,16,53,4,36,53,3,16,54,4,36,54,4,16,55,4,36,55,4,16,56,4,36,56,4,16,57,4,35,57,3,14,58,2,16,58,1,35,58,3,14,59,2,16,59,1,35,59,4,15,60,3,35,60,4,16,61,3,35,61,4,16,62,3,35,62,4,16,63,2,35,63,5,34,64,5,34,65,5,34,66,4,33,67,3,33,68,3,32,69,2],
            reds:[ 21,29,2,22,30,3,22,31,4,31,31,4,23,32,5,32,32,6,23,33,5,31,33,6,30,34,12,30,35,12,30,36,12,31,37,13,31,38,14,32,39,15,32,40,15,32,41,15,31,42,14,31,43,14,31,44,14,31,45,14,30,46,13,30,47,13,30,48,13,30,49,13,30,50,13,30,51,13,30,52,13,30,53,13,29,54,12,29,55,12,29,56,12,29,57,12,20,58,3,29,58,6,20,59,3,29,59,4,20,60,3,29,60,3,20,61,3,29,61,3,20,62,3,29,62,3,20,63,3,29,63,3,20,64,3,28,64,2,20,65,3,28,65,2,20,66,3,29,66,3,20,67,3,29,67,3,20,68,3,29,68,3,20,69,3,29,69,3,20,70,3,29,70,3,20,71,3,29,71,3,20,72,3,29,72,3,20,73,3,29,73,3,20,74,2,29,74,3,20,75,2,29,75,3,20,76,2,29,76,3,20,77,2,29,77,2,20,78,2,29,78,2,21,79,3,29,79,2,21,80,2,29,80,2,21,81,2,30,81,3,21,82,1,30,82,3,22,83,2,30,83,3,22,84,2,30,84,2,22,85,2,30,85,2,22,86,3,31,86,3,22,87,5,31,87,3,22,88,6,31,88,2,19,89,4,31,89,2,32,90,3,32,91,3,32,92,4,32,93,5,31,94,5,29,95,3]};

         var imgdata1 = {
            blacks:[23,10,24,10,25,10,26,10,27,10,28,10,21,11,22,11,29,11,30,11,20,12,31,12,19,13,32,13,18,14,32,14,18,15,33,15,18,16,33,16,18,17,33,17,18,18,19,18,33,18,18,19,19,19,25,19,26,19,27,19,33,19,18,20,19,20,25,20,26,20,27,20,33,20,18,21,25,21,26,21,27,21,32,21,18,22,32,22,18,23,32,23,19,24,22,24,23,24,32,24,19,25,31,25,20,26,31,26,21,27,30,27,21,28,22,28,23,28,24,28,30,28,31,28,32,28,20,29,33,29,20,30,34,30,19,31,35,31,19,32,35,32,19,33,36,33,19,34,36,34,18,35,36,35,18,36,33,36,37,36,18,37,33,37,37,37,18,38,33,38,34,38,37,38,18,39,33,39,34,39,37,39,18,40,33,40,34,40,38,40,18,41,33,41,34,41,38,41,17,42,33,42,35,42,38,42,17,43,33,43,35,43,38,43,17,44,32,44,35,44,38,44,17,45,19,45,32,45,35,45,39,45,17,46,19,46,32,46,35,46,39,46,17,47,19,47,32,47,35,47,39,47,16,48,19,48,32,48,35,48,39,48,16,49,19,49,32,49,35,49,39,49,16,50,19,50,32,50,35,50,39,50,16,51,19,51,32,51,35,51,39,51,16,52,19,52,32,52,34,52,39,52,15,53,19,53,32,53,34,53,39,53,15,54,19,54,32,54,34,54,39,54,15,55,19,55,32,55,34,55,39,55,14,56,16,56,19,56,32,56,33,56,39,56,14,57,16,57,19,57,23,57,24,57,25,57,26,57,31,57,33,57,39,57,14,58,19,58,23,58,26,58,31,58,33,58,38,58,14,59,19,59,23,59,26,59,31,59,33,59,38,59,15,60,18,60,19,60,23,60,26,60,31,60,32,60,38,60,16,61,17,61,19,61,23,61,26,61,31,61,32,61,38,61,19,62,23,62,26,62,31,62,33,62,37,62,19,63,23,63,26,63,31,63,33,63,37,63,19,64,23,64,26,64,31,64,33,64,36,64,19,65,23,65,27,65,31,65,33,65,34,65,35,65,19,66,23,66,27,66,31,66,19,67,23,67,27,67,31,67,32,67,33,67,34,67,19,68,23,68,27,68,31,68,35,68,19,69,23,69,27,69,31,69,35,69,19,70,23,70,24,70,25,70,26,70,27,70,31,70,36,70,19,71,23,71,28,71,32,71,33,71,37,71,19,72,28,72,32,72,34,72,35,72,38,72,19,73,26,73,27,73,28,73,32,73,36,73,37,73,19,74,24,74,25,74,28,74,32,74,20,75,21,75,22,75,23,75,28,75,32,75,28,76,32,76,29,77,32,77,29,78,33,78,29,79,33,79,29,80,33,80,29,81,33,81,30,82,33,82,30,83,34,83,30,84,34,84,30,85,34,85,30,86,34,86,29,87,35,87,28,88,35,88,28,89,27,90,27,91],
            yellows:[28,11,6,30,12,10,31,13,12,31,14,13,32,15,14,32,16,14,32,17,14,32,18,13,24,19,5,32,19,5,24,20,5,32,20,5,24,21,6,31,21,4,31,22,13,31,23,13,21,24,2,31,24,8,30,25,11,30,26,10,29,27,8,29,28,5,28,29,6,27,30,5,33,30,1,26,31,3,34,31,3,25,32,2,34,32,3,35,33,4,35,34,3,19,35,1,35,35,3,19,36,1,36,36,3,19,37,1,36,37,3,19,38,1,36,38,2,19,39,1,36,39,2,19,40,1,37,40,3,19,41,1,37,41,3,19,42,2,37,42,2,19,43,2,37,43,2,19,44,2,37,44,2,18,45,1,38,45,3,18,46,1,38,46,3,18,47,1,38,47,3,18,48,2,38,48,3,18,49,2,38,49,3,18,50,2,38,50,3,18,51,2,38,51,3,18,52,2,38,52,4,18,53,3,38,53,4,18,54,3,38,54,4,18,55,3,38,55,4,15,56,1,18,56,2,38,56,5,15,57,1,18,57,2,38,57,5,18,58,4,37,58,4,18,59,4,37,59,4,17,60,2,37,60,5,37,61,5,36,62,3,36,63,3,35,64,2],
            reds:[22,29,2,32,29,4,22,30,2,32,30,5,23,31,4,31,31,5,23,32,4,31,32,6,31,33,12,32,34,13,32,35,13,32,36,13,32,37,13,32,38,13,32,39,13,32,40,13,32,41,13,32,42,13,32,43,13,31,44,12,31,45,12,31,46,12,31,47,12,31,48,12,31,49,12,31,50,12,31,51,12,31,52,12,31,53,12,31,54,12,31,55,12,31,56,12,22,57,3,30,57,4,22,58,3,30,58,4,22,59,3,30,59,4,22,60,3,30,60,4,22,61,3,30,61,4,22,62,3,30,62,4,22,63,3,30,63,4,22,64,3,30,64,4,22,65,3,30,65,3,22,66,3,30,66,3,22,67,3,30,67,3,22,68,3,30,68,3,34,68,3,22,69,3,30,69,3,34,69,3,22,70,3,30,70,3,35,70,4,22,71,3,27,71,4,31,71,3,36,71,3,27,72,8,31,72,3,37,72,2,25,73,6,31,73,3,23,74,4,31,74,3,31,75,3,31,76,3,31,77,2,32,78,3,32,79,3,32,80,3,32,81,3,32,82,2,33,83,3,33,84,3,33,85,3,33,86,3,34,87,5,34,88,6,33,89,5,31,90,4,28,91,1]
         };

         var imgdata2 = {
            blacks:[ 23,8,24,8,25,8,26,8,27,8,28,8,21,9,22,9,29,9,30,9,20,10,31,10,19,11,32,11,18,12,32,12,18,13,33,13,18,14,33,14,18,15,33,15,18,16,19,16,33,16,18,17,19,17,25,17,26,17,27,17,33,17,18,18,19,18,25,18,26,18,27,18,33,18,18,19,25,19,26,19,27,19,32,19,18,20,32,20,18,21,32,21,19,22,22,22,23,22,32,22,19,23,31,23,20,24,31,24,21,25,30,25,22,26,23,26,24,26,30,26,21,27,30,27,31,27,21,28,32,28,21,29,32,29,21,30,33,30,21,31,33,31,21,32,33,32,21,33,33,33,21,34,29,34,33,34,21,35,29,35,33,35,21,36,29,36,33,36,21,37,29,37,33,37,21,38,29,38,33,38,21,39,29,39,33,39,21,40,29,40,33,40,20,41,29,41,33,41,20,42,29,42,33,42,20,43,29,43,33,43,20,44,29,44,33,44,20,45,28,45,33,45,20,46,28,46,32,46,20,47,28,47,32,47,20,48,28,48,32,48,20,49,27,49,32,49,20,50,27,50,32,50,20,51,27,51,32,51,19,52,26,52,31,52,32,52,19,53,26,53,31,53,32,53,19,54,24,54,25,54,26,54,31,54,32,54,18,55,23,55,25,55,31,55,32,55,18,56,23,56,25,56,30,56,32,56,18,57,22,57,24,57,30,57,32,57,17,58,22,58,24,58,30,58,32,58,17,59,21,59,23,59,29,59,32,59,16,60,21,60,22,60,29,60,32,60,16,61,20,61,21,61,22,61,28,61,32,61,15,62,20,62,23,62,28,62,32,62,15,63,19,63,23,63,27,63,32,63,14,64,19,64,23,64,26,64,28,64,32,64,14,65,18,65,23,65,24,65,25,65,28,65,32,65,13,66,18,66,28,66,32,66,13,67,17,67,28,67,32,67,12,68,16,68,28,68,33,68,12,69,16,69,29,69,33,69,13,70,17,70,29,70,33,70,13,71,17,71,29,71,33,71,14,72,18,72,30,72,34,72,15,73,19,73,30,73,34,73,16,74,20,74,31,74,35,74,17,75,21,75,31,75,35,75,18,76,22,76,32,76,36,76,19,77,23,77,32,77,36,77,20,78,24,78,33,78,37,78,20,79,24,79,33,79,37,79,20,80,24,80,34,80,38,80,20,81,23,81,34,81,38,81,19,82,22,82,35,82,39,82,19,83,21,83,35,83,39,83,19,84,20,84,36,84,39,84,36,85,39,85,35,86,39,86,34,87,38,87 ],
            yellows:[ 28,9,6,30,10,10,31,11,12,31,12,13,32,13,14,32,14,14,32,15,14,32,16,13,24,17,5,32,17,5,24,18,5,32,18,5,24,19,6,31,19,4,31,20,13,31,21,13,21,22,2,31,22,8,30,23,11,30,24,10,29,25,8,29,26,5,29,27,7,28,28,6,31,28,1,27,29,5,31,29,2,26,30,3,32,30,3,25,31,2,32,31,3,32,32,3,32,33,3,32,34,3,32,35,3,32,36,3,32,37,3,32,38,3,32,39,3,32,40,3,32,41,3,32,42,3,32,43,3,32,44,3,32,45,4,31,46,3,31,47,3,31,48,3,31,49,4,31,50,4,31,51,4,30,52,4,30,53,4,30,54,4,30,55,5,29,56,4,29,57,5,29,58,5,28,59,5,28,60,6,27,61,5,27,62,4,26,63,3,25,64,2 ],
            reds:[ 22,27,1,22,28,1,30,28,2,22,29,1,29,29,2,23,30,2,29,30,3,23,31,2,29,31,4,29,32,8,29,33,8,28,34,7,28,35,7,28,36,7,28,37,7,28,38,7,28,39,7,28,40,7,28,41,8,28,42,8,28,43,8,28,44,8,27,45,7,27,46,7,27,47,7,27,48,7,26,49,6,26,50,6,26,51,6,25,52,6,25,53,6,23,54,4,22,55,4,22,56,4,31,56,1,21,57,3,31,57,1,21,58,4,31,58,1,20,59,3,31,59,2,20,60,4,31,60,2,19,61,3,31,61,3,19,62,4,31,62,3,18,63,3,31,63,4,18,64,4,31,64,3,17,65,3,31,65,3,17,66,4,31,66,3,16,67,3,31,67,3,15,68,3,32,68,4,15,69,3,32,69,3,16,70,3,32,70,3,16,71,3,32,71,3,17,72,3,33,72,3,18,73,3,33,73,3,19,74,3,34,74,3,20,75,3,34,75,3,21,76,3,35,76,3,22,77,3,35,77,3,23,78,3,36,78,3,23,79,3,36,79,3,23,80,3,37,80,3,22,81,2,37,81,3,21,82,2,38,82,3,20,83,1,38,83,3,38,84,2,38,85,2,38,86,3,37,87,3 ]};

         function drawRImage(rimage, ux, uy, ds) {
            for ( var i = 0; i < rimage.yellows.length; ++i ) {
                var item = rimage.yellows[i];
                var dx = item[0];
                var dy = item[1];
                var len = item[2];
                context.fillStyle = "yellow";
                context.fillRect(ux+(dx-len+1)*ds,uy+dy*ds,ds*len,ds);
            }
            for ( var i = 0; i < rimage.reds.length; ++i ) {
                var item = rimage.reds[i];
                var dx = item[0];
                var dy = item[1];
                var len = item[2];
                context.fillStyle = "red";
                context.fillRect(ux+(dx-len+1)*ds,uy+dy*ds,ds*len,ds);
            }
            for ( var i = 0; i < rimage.blacks.length; ++i ) {
                var item = rimage.blacks[i];
                var dx = item[0];
                var dy = item[1];
                context.fillStyle = "black";
                context.fillRect(ux+dx*ds,uy+dy*ds,ds,ds);
            }
         }

         function drawRImage2(rimage, ux, uy, ds) {
            for ( var i = 0; i < rimage.yellows.length/3; ++i ) {
                var dx  = rimage.yellows[i*3+0];
                var dy  = rimage.yellows[i*3+1];
                var len = rimage.yellows[i*3+2];
                context.fillStyle = "yellow";
                context.fillRect(ux+(dx-len+1)*ds,uy+dy*ds,ds*len,ds);
            }
            for ( var i = 0; i < rimage.reds.length/3; ++i ) {
                var dx  = rimage.reds[i*3+0];
                var dy  = rimage.reds[i*3+1];
                var len = rimage.reds[i*3+2];
                context.fillStyle = "red";
                context.fillRect(ux+(dx-len+1)*ds,uy+dy*ds,ds*len,ds);
            }
            for ( var i = 0; i < rimage.blacks.length/2; ++i ) {
                var dx = rimage.blacks[i*2+0];
                var dy = rimage.blacks[i*2+1];
                context.fillStyle = "black";
                context.fillRect(ux+dx*ds,uy+dy*ds,ds,ds);
            }
         }

         var printed = 0;
         function drawBackground() {
            context.fillStyle = "green";
            context.fillRect(0,0,screenWidth,screenHeight);
            context.drawImage(animImages[phase],0,0,500,280);

            context.beginPath();
            context.lineWidth = "1";
            context.strokeStyle = "darkgreen";
            var gridx = 54.5;
            var gridy = 122;
            var shx = 29;
            var shy = 25;
            var areax = 54;
            var areay = 100;
            for ( var x = 0; x < 8; ++x ) {
               for ( var y = 0; y < 2; ++y ) {
                  context.rect(shx+Math.floor(gridx*x),shy+gridy*y,areax,areay);
               }
            }
            context.stroke();
            var ix = 1;
            var iy = 1;
            var cntr = 0;
            var rude = 1;
            var rimage = { blacks:[], reds:[], yellows:[] };
            for ( var dy = 0; dy < areay; ++dy ) {
                for ( var dx = 0; dx < areax; ++dx ) {
                  var dat = context.getImageData(shx+dx+Math.floor(ix*gridx),shy+iy*gridy+dy,1,1);
                  if ( !dat.data[0] && !dat.data[1] && !dat.data[2] ) {
                     // black
                     rimage.blacks.push([dx,dy]);
                     ++cntr;
                  } else if ( dat.data[0] && !dat.data[1] && !dat.data[2] ) {
                     // red
                     var cdid = [dx,dy,1];
                     if ( rimage.reds.length && rimage.reds[rimage.reds.length-1][0] == dx-1 && rimage.reds[rimage.reds.length-1][1] == dy ) {
                        var lst = rimage.reds[rimage.reds.length-1];
                        rimage.reds[rimage.reds.length-1] = [dx,dy,lst[2]+1];
                     } else {
                        rimage.reds.push(cdid);
                     }
                  } else if ( !(!dat.data[0] && dat.data[1] && !dat.data[2]) ) {
                     // yellow
                     var cdid = [dx,dy,1];
                     if ( rimage.yellows.length && rimage.yellows[rimage.yellows.length-1][0] == dx-1 && rimage.yellows[rimage.yellows.length-1][1] == dy ) {
                        var lst = rimage.yellows[rimage.yellows.length-1];
                        rimage.yellows[rimage.yellows.length-1] = [dx,dy,lst[2]+1];
                     } else {
                        rimage.yellows.push(cdid);
                     }

                  }
               }
            }

            drawRImage(rimage,500,100,5);
            drawRImage2(imgdata2,800,100,5);
            if ( !printed ) {
               printed = 1;
               console.log('{blacks:[',rimage.blacks.toString(),'],');
               console.log('yellows:[',rimage.yellows.toString(),'],');
               console.log('reds:[',rimage.reds.toString(),']}');
            }

            phase = (phase + 1)%8;
         }

         // common functions 
         function drawScene() {
            setTimeout( function() {
               drawBackground();
               ANIMATION = requestAnimationFrame(drawScene);
            }, 1000 / fps );
         }

         function initCanvas() {
            screenWidth  = mainItem.width  = window.innerWidth  - 20;
            screenHeight = mainItem.height = window.innerHeight - 20;
            screenScale  = Math.min( screenWidth, screenHeight ) / 2;

            // starting the engine only if it is not running
            if ( !ANIMATION ) {
               drawScene();
            }
         }

         //init
         (function() {
            initCanvas();
            addEventListener('resize', initCanvas, false);
         })();
      </script>
   </body>
</html>
